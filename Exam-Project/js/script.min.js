document.addEventListener("DOMContentLoaded",()=>{console.log("script.js loaded successfully!");let e=document.querySelector(".ham-menu"),t=document.querySelector(".off-screen-menu"),a=document.getElementById("MainContent")||document.querySelector("main"),r=t.querySelectorAll("a, button"),s=()=>{t.classList.add("active"),e.classList.add("active"),e.setAttribute("aria-expanded","true"),a&&a.setAttribute("aria-hidden","true"),r.length>0&&r[0].focus()},i=()=>{t.classList.remove("active"),e.classList.remove("active"),e.setAttribute("aria-expanded","false"),a&&a.setAttribute("aria-hidden","false"),e.focus()};if(e.addEventListener("click",()=>{let t="true"===e.getAttribute("aria-expanded");t?i():s()}),a&&a.addEventListener("click",()=>{t.classList.contains("active")&&i()}),document.addEventListener("keydown",e=>{if("Escape"===e.key&&t.classList.contains("active")&&i(),"Tab"===e.key&&t.classList.contains("active")){let a=document.activeElement,s=r[0],n=r[r.length-1];e.shiftKey?a===s&&(n.focus(),e.preventDefault()):a===n&&(s.focus(),e.preventDefault())}}),document.querySelector(".sign-up")){let n=document.querySelector(".sign-up"),o=document.getElementById("firstName"),l=document.getElementById("emailAddress"),d=n.querySelector('button[type="submit"]'),c=(e,t)=>{let a=e.nextElementSibling;a&&a.classList.contains("newsletter-error-message")||((a=document.createElement("div")).classList.add("newsletter-error-message"),e.parentNode.insertBefore(a,e.nextSibling)),a.textContent=t,e.setAttribute("aria-invalid","true"),e.classList.add("input-error")},u=e=>{let t=e.nextElementSibling;t&&t.classList.contains("newsletter-error-message")&&t.remove(),e.removeAttribute("aria-invalid"),e.classList.remove("input-error")},m=()=>{let e=!0;""===o.value.trim()?(c(o,"First name is required."),e=!1):u(o);let t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return""===l.value.trim()?(c(l,"Email address is required."),e=!1):t.test(l.value.trim())?u(l):(c(l,"Please enter a valid email address."),e=!1),e};n.addEventListener("submit",async e=>{if(e.preventDefault(),m()){d.disabled=!0,o.disabled=!0,l.disabled=!0,d.textContent="Sending...",console.log("Form is valid and ready for submission!"),console.log("First Name:",o.value.trim()),console.log("Email Address:",l.value.trim());try{await new Promise(e=>setTimeout(e,2e3)),alert("Thank you for signing up for our newsletter!"),n.reset()}catch(t){console.error("Submission failed:",t),alert("There was an error signing up. Please try again.")}finally{d.disabled=!1,o.disabled=!1,l.disabled=!1,d.textContent="Send"}}else alert("Please correct the errors in the form.")}),o.addEventListener("input",()=>{""!==o.value.trim()&&u(o)}),l.addEventListener("input",()=>{let e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;""!==l.value.trim()&&e.test(l.value.trim())&&u(l)}),o.addEventListener("blur",()=>{""===o.value.trim()&&c(o,"First name is required.")}),l.addEventListener("blur",()=>{let e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;""===l.value.trim()?c(l,"Email address is required."):e.test(l.value.trim())||c(l,"Please enter a valid email address.")})}if(document.getElementById("map")){let p=document.getElementById("map"),y=document.getElementById("loading-state"),g=document.getElementById("error-state");function h(){return new Promise((e,t)=>{if("undefined"!=typeof google&&google.maps){e(google.maps);return}let a=document.createElement("script");a.src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_HERE&loading=async&callback=initMapPlaceholder",a.async=!0,a.defer=!0,a.onload=()=>{e(google.maps)},a.onerror=e=>{console.error("Error loading Google Maps API:",e),t(Error("Failed to load Google Maps. Please check your API key and/or network connection."))},document.head.appendChild(a)})}async function f(){try{g.style.display="none";let{Map:e}=await google.maps.importLibrary("maps"),t={center:{lat:60.3042,lng:10.63595},zoom:8,mapId:"YOUR_MAP_ID_HERE"},a=new e(p,t);y.style.display="none";let{AdvancedMarkerElement:r}=await google.maps.importLibrary("marker");new r({position:t.center,map:a,title:"Braastad Gaard"}),console.log("Google Map initialized successfully!")}catch(s){console.error("Error during map initialization:",s),y.style.display="none",g.textContent=`Error initializing map: ${s.message}`,g.style.display="block",p.style.display="none"}}window.initMapPlaceholder=()=>{f()},(async()=>{y.style.display="block";try{await h()}catch(e){console.error("Critical error before map initialization:",e),y.style.display="none",g.textContent=`Critical error: ${e.message}`,g.style.display="block",p.style.display="none"}})()}if(document.getElementById("chatMessages")){let v=document.getElementById("chatMessages"),b=document.getElementById("messageInput"),E=document.getElementById("sendMessage"),k=document.getElementById("statusMessage"),w=`
        You are a helpful and friendly customer service chatbot named FRAM for Fram.
        Fram is a fictional circular service based in Norway that specializes in high-quality, ethically sourced, organic produce.

        Our Products:
        - Oats: Hearty and wholesome, our organic oats are perfect for a nourishing breakfast or baking. Price: 16 kr/kg.
        - Red Onions: Our vibrant organic red onions offer a crisp texture and a sweet, pungent flavor ideal for any dish. Price: 45 kr/kg.
        - Garlic: Potent and aromatic, our organic garlic bulbs are essential for adding depth to your cooking. Price: 38 kr/kg.
        - Potatoes: Versatile and nutritious, our organic potatoes are sustainably grown and perfect for roasting, mashing, or baking. Price: 32 kr/kg.
        - Carrots: Sweet and crunchy, our organic carrots are packed with flavor and make a healthy addition to any meal. Price: 48 kr/kg.
        - New produce is added continuously as time goes by and the seasons change. Customers can stay updated by signing up for our newsletter.

        Ordering and Shipping:
        - We currently only deliver in Norway.
        - Shipping is free!
        - Orders are typically processed within 1-2 business days and delivered within 3-7 business days depending on destination.
        - Customers can keep the containers that the produce is stored in. If they later want a refill, they can scan the QR code on the container to instantly add the items back to their cart. When we deliver a new order, the customer can leave their empty containers outside, and we will pick them up, clean them thoroughly, and reuse them for further deliveries.

        Return Policy:
        - We offer a 30-day return policy for unopened and unused products, starting from the date of delivery.
        - A valid proof of purchase (receipt or order number) is required for all returns.
        - Customers are responsible for return shipping costs unless the product is defective or incorrect.
        - To initiate a return, please contact our customer service.

        Customer Service Contact:
        - Email: info@framsorganic.com
        - Phone: +47 123 45 678 (fictional)

        Always prioritize providing information based ONLY on the details provided here. If a question is outside this scope, politely state that you cannot answer.
        `,P=[];function L(e,t){if("user"===t){let a=document.createElement("div");a.classList.add("message","user-message"),a.textContent=e,v.appendChild(a)}else if("bot"===t){let r=document.createElement("div");r.classList.add("bot-message-wrapper");let s=document.createElement("span");s.classList.add("bot-logo-text"),s.textContent="FRAM";let i=document.createElement("div");i.classList.add("message","bot-message-bubble"),i.textContent=e,r.appendChild(s),r.appendChild(i),v.appendChild(r)}requestAnimationFrame(()=>{v.scrollTop=v.scrollHeight})}function I(e,t=!1){k.textContent=e,k.className=`status-message ${t?"error-message":""}`,setTimeout(()=>{k.textContent="",k.className="status-message"},3e3)}async function A(e){L(e,"user"),P.push({role:"user",content:e}),b.value="",b.disabled=!0,E.disabled=!0,I("...");try{let t=await fetch("YOUR_OPENAI_API_ENDPOINT",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer YOUR_OPENAI_API_KEY"},body:JSON.stringify({model:"YOUR_GPT_MODEL",messages:[{role:"system",content:w},...P],max_tokens:350,temperature:.7})});if(!t.ok){let a=await t.json();console.error("OpenAI API Error:",a);let r="An unexpected error occurred.";throw 401===t.status?r="Authentication failed. Please check your API key.":429===t.status?r="Too many requests. Please try again in a moment.":t.status>=500?r="Server error. Please try again later.":a&&a.error&&a.error.message&&(r=`API Error: ${a.error.message}`),Error(r)}let s=await t.json(),i=s.choices[0].message.content.trim();L(i,"bot"),P.push({role:"assistant",content:i}),I("Response received.")}catch(n){console.error("Fetch error:",n),L(`${n.message}`,"bot"),I(`${n.message}`,!0)}finally{b.disabled=!1,E.disabled=!1,b.focus()}}E.addEventListener("click",()=>{let e=b.value.trim();e&&A(e)}),b.addEventListener("keydown",e=>{if("Enter"===e.key&&!e.shiftKey){e.preventDefault();let t=b.value.trim();t&&A(t)}}),L("What can I help you with today?","bot")}});